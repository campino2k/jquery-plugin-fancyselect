/*!
 * jQuery.FancySelect()
 * 
 * @author Christian Jung <campino2k@gmail.com>
 * @license CC-BY-NC-SA
 *
 * Date: Fri Apr 2 12:24:25 2010 +0200 
 *
 * Tutorial for developing jQuery plugins
 * http://www.learningjquery.com/2007/10/a-plugin-development-pattern
 *
 */

var searchString="";
(function(a){a.fn.FancySelect=function(c){opts=a.extend({},a.fn.FancySelect.defaults,c);return this.each(function(){var b=a(this);b.wrap('<div class="select_replace" id="'+b.attr("name")+'_dropdown"></div>').hide();var d=b.parents(".select_replace");d.append('<div class="display">'+b.find("option:selected").text()+"</div>");d.click(function(){a.fn.FancySelect.openList(d)})})};a.fn.FancySelect.openList=function(c){var b=a(c),d=b.find("select"),e=b.find("select optgroup"),g=b.find("select option"),h=
e.length,i=g.length,f=b.find(".options").length;if(i>0&&f==0){b.append('<div class="options"></div>');b=b.find(".options").empty();for(f=0;f<h;f++){b.append('<div class="group"></div>');var j=b.find("div.group:last");a(e[f]).attr("label")!=""&&j.append("<strong>"+a(e[f]).attr("label")+"</strong>");var k=a(e[f]).find("option");a.fn.FancySelect.renderOptions(k,k.length,j)}h==0&&a.fn.FancySelect.renderOptions(g,i,b)}else if(b.find("div.options:hidden").length)b.find("div.options").show();else{a.fn.FancySelect.closeList();
return}e=a("div.options");e.css({overflow:"auto",height:a(c).find("li").outerHeight()*opts.maxEntries+"px"});e.find("li").removeClass("entry_selected");$options_actual=e.find('li[clickvalue="'+d.val()+'"]');$options_actual.addClass("entry_selected");c=$options_actual;for(d=0;c.hasClass("options")==false;){d+=c.position().top;c=c.parent()}d>=e.outerHeight()&&e.scrollTop(d);a(document).keypress(function(l){a.fn.FancySelect.findEntryByKey(l)})};a.fn.FancySelect.renderOptions=function(c,b,d){$ul=a("<ul/>");
a(d).append($ul);for(d=0;d<b;d++){var e=a("<li/>",{clickvalue:a(c[d]).attr("value"),text:a(c[d]).text(),mouseenter:function(){a(this).addClass("entry_hover")},mouseleave:function(){a(this).removeClass("entry_hover")},click:function(){a.fn.FancySelect.clickEntry(a(this))}});$ul.append(e)}};a.fn.FancySelect.clickEntry=function(c){var b=a(c).parents(".select_replace");b.find(".display").text(a(c).text());b.find("select").val(a(c).attr("clickvalue"));b.find("select").trigger("change")};a.fn.FancySelect.closeList=
function(){a("div.options:visible").hide();a(document).unbind("keydown")};a.fn.FancySelect.findEntryByKey=function(c){var b="";b=c.which;try{window.clearTimeout(clearString)}catch(d){}if(b==32||b>=48&&b<=122){c=String.fromCharCode(b);searchString+=c;clearString=window.setTimeout('searchString="";',opts.searchResetTime);c=a("div.options:visible li").filter(function(){return(new RegExp("^"+searchString,"i")).test(a(this).text())});c.parents("ul").find("li").trigger("mouseleave");c.first().trigger("mouseenter")}if(b==
13){a("div.options:visible li.entry_hover").trigger("click");a("div.options:visible li.entry_selected").trigger("click")}};a.fn.FancySelect.defaults={maxEntries:"8",searchResetTime:600}})(jQuery);
